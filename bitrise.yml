format_version: 1.1.0
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

workflows:
  test:
    steps:

    - change-workdir:    
        title: Prepare directory
        description: |-
          Create a temporary folder and switch working directory.
        run_if: true
        inputs:
        - path: ./_tmp
        - is_create_path: true

    - script:
        title: Prepare files
        is_always_run: false
        description: |-
          Copy the localazy.json file that is necessary for running the test.     
        inputs:
        - content: |-
            #!/bin/bash
            cp ../localazy.json localazy.json        
            exit 0

    - path::./:
        title: Run step
        description: |-
          Test Localazy CLI by downloading our read-only project.
        inputs:
        - read_key: "a8922414862262844150-ef174facb0705d300579ae24ccafb7b7781ff8e784569f36711f7eb8f972952a"
        - write_key: "a8922414862262844150-79fa693a6be31df63e03fc53c025cb4db7b0e5c7de9d8ad23db2aacb1f624dfa"
        
    - script:
        title: Verify results
        is_always_run: false
        description: |-
          Verify that file test_cs.xml exists. It should be downloaded by running previous step.
        inputs:
        - content: |-
            #!/bin/bash
            [ -f "test_cs.xml" ] && exit 0          
            exit 1

    - script:
        title: Clean temporary files
        is_always_run: true
        description: |-
          Remove the temporary folder.
        inputs:
        - content: |-
            #!/bin/bash
            rm -r ../_tmp >/dev/null 2>&1
            exit 0
